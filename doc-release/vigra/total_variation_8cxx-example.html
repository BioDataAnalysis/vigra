<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><TITLE>vigra - total_variation.cxx</TITLE>
<link rel=stylesheet type="text/css" href="vigra.css">
<link rel=stylesheet type="text/css" href="vigra_1_8_2.css">
<link rel="shortcut icon" href="vigra-icon.ico" />
<script type="text/javascript">
function toggleHiddenDocumentation( textID, toggleID, toggleMessage )
{
	if( document.getElementById(textID).style.display == 'none' )
    {
		document.getElementById(textID).style.display = 'block';
        document.getElementById(toggleID).innerHTML = "hide " + toggleMessage;
    }
    else
    {
		document.getElementById(textID).style.display = 'none';
        document.getElementById(toggleID).innerHTML = "show " + toggleMessage;
	}
    return false;
}
</script>
<script>
var runOnLoad=function(c,o,d,e){function x(){for(e=1;c.length;)c.shift()()}o[d]?(document[d]('DOMContentLoaded',x,0),o[d]('load',x,0)):o.attachEvent('onload',x);return function(t){e?o.setTimeout(t,0):c.push(t)}}([],window,'addEventListener');
</script>
<script type="text/javascript" src="documents/CollapsibleLists.js"></script>
<script type="text/javascript">
    runOnLoad(function(){ CollapsibleLists.apply(); });
</script>
<style type="text/css">
.collapsibleList li.collapsibleListOpen{
  list-style-image:url('documents/pfeil.gif');
  cursor:pointer;
}
.collapsibleList li.collapsibleListClosed{
  list-style-image:url('documents/bullet.gif');
  cursor:pointer;
}
.collapsibleList li.lastItem{
  list-style-image:url('documents/diamond.gif');
}
</style>
</head>
<body  bgcolor="#f8f0e0" link="#0040b0" vlink="#a00040">
<basefont face="Helvetica,Arial,sans-serif" size=3>
<p align=right>
[ <a href="http://ukoethe.github.io/vigra/">VIGRA Homepage</a> |
 <a href="functionindex.html">Function Index</a> |
 <a href="classes.html">Class Index</a> |
 <a href="namespaces.html">Namespaces</a> |
 <a href="files.html">File List</a> |
 <a href="index.html">Main Page</a> ]
</p>
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="contents">
<table class="main_heading">
<tr>
<td width="100%">total_variation.cxx
</td>
<td align=right><a href="http://hci.iwr.uni-heidelberg.de/vigra/"><IMG border=0 ALT="VIGRA" SRC="documents/vigra.gif" title="VIGRA Homepage"></a></td></tr>
</table><p>

<p>Smooth an image with Total Variation (TV) regularization (standard ROF model, anisotropic, second order)<br/>
 Usage: <code>example_total_variation</code> reads a given parameter file (see tv.par, aniso_tv.par, secondo_oder_tv.par in the examples subfolder) and performes a smoothing with TV regularization with the parameters given in this file.</p>
<div class="fragment"><div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/*                 Copyright 2012 by Frank Lenzen &amp;                     */</span></div>
<div class="line"><span class="comment">/*                                           Ullrich Koethe             */</span></div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/*    This file is part of the VIGRA computer vision library.           */</span></div>
<div class="line"><span class="comment">/*    The VIGRA Website is                                              */</span></div>
<div class="line"><span class="comment">/*        http://hci.iwr.uni-heidelberg.de/vigra/                       */</span></div>
<div class="line"><span class="comment">/*    Please direct questions, bug reports, and contributions to        */</span></div>
<div class="line"><span class="comment">/*        ullrich.koethe@iwr.uni-heidelberg.de    or                    */</span></div>
<div class="line"><span class="comment">/*        vigra@informatik.uni-hamburg.de                               */</span></div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/*    Permission is hereby granted, free of charge, to any person       */</span></div>
<div class="line"><span class="comment">/*    obtaining a copy of this software and associated documentation    */</span></div>
<div class="line"><span class="comment">/*    files (the &quot;Software&quot;), to deal in the Software without           */</span></div>
<div class="line"><span class="comment">/*    restriction, including without limitation the rights to use,      */</span></div>
<div class="line"><span class="comment">/*    copy, modify, merge, publish, distribute, sublicense, and/or      */</span></div>
<div class="line"><span class="comment">/*    sell copies of the Software, and to permit persons to whom the    */</span></div>
<div class="line"><span class="comment">/*    Software is furnished to do so, subject to the following          */</span></div>
<div class="line"><span class="comment">/*    conditions:                                                       */</span></div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/*    The above copyright notice and this permission notice shall be    */</span></div>
<div class="line"><span class="comment">/*    included in all copies or substantial portions of the             */</span></div>
<div class="line"><span class="comment">/*    Software.                                                         */</span></div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/*    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND    */</span></div>
<div class="line"><span class="comment">/*    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES   */</span></div>
<div class="line"><span class="comment">/*    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND          */</span></div>
<div class="line"><span class="comment">/*    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT       */</span></div>
<div class="line"><span class="comment">/*    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,      */</span></div>
<div class="line"><span class="comment">/*    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING      */</span></div>
<div class="line"><span class="comment">/*    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR     */</span></div>
<div class="line"><span class="comment">/*    OTHER DEALINGS IN THE SOFTWARE.                                   */</span>                </div>
<div class="line"><span class="comment">/*                                                                      */</span></div>
<div class="line"><span class="comment">/************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/multi_array.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/stdimagefunctions.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="impex_8hxx.html">vigra/impex.hxx</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/tv_filter.hxx&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define strcasecmp _stricmp</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">using namespace </span>vigra; </div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Read a string from file &lt;file&gt;.</span></div>
<div class="line"><span class="keywordtype">void</span> read_string(FILE *file,<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">char</span>* out){</div>
<div class="line">    <span class="keywordtype">char</span> dummy[80];</div>
<div class="line">    <span class="keywordtype">int</span> s=fscanf(file,<span class="stringliteral">&quot;%s %s &quot;</span>,dummy,out);</div>
<div class="line">    <span class="keywordflow">if</span> (s==EOF || s&lt;2){</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Could not read from file.\n&quot;</span>;</div>
<div class="line">        exit(0); </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(name,dummy)!=0){</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Found parameter &quot;</span>&lt;&lt;dummy&lt;&lt;<span class="stringliteral">&quot; instead of &quot;</span>&lt;&lt;name&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        exit(0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;Parameter &quot;</span>&lt;&lt;name&lt;&lt;<span class="stringliteral">&quot; = &quot;</span>&lt;&lt;out&lt;&lt;std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// read a flota-value from file &lt;file&gt;</span></div>
<div class="line"><span class="keywordtype">float</span> read_value(FILE *file,<span class="keyword">const</span> <span class="keywordtype">char</span> *name){</div>
<div class="line">    <span class="keywordtype">char</span> dummy[80];</div>
<div class="line">    <span class="keywordtype">char</span> dummy2[80];</div>
<div class="line">    <span class="keywordtype">float</span> f=0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> s=fscanf(file,<span class="stringliteral">&quot;%s %s &quot;</span>,dummy,dummy2); </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (s==EOF || s&lt;2){</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Could not read from file.\n&quot;</span>;</div>
<div class="line">        exit(0); </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(name,dummy)!=0){</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Found parameter &quot;</span>&lt;&lt;dummy&lt;&lt;<span class="stringliteral">&quot; instead of &quot;</span>&lt;&lt;name&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        exit(0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>{</div>
<div class="line">        f=atof(dummy2);</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Parameter &quot;</span>&lt;&lt;name&lt;&lt;<span class="stringliteral">&quot; = &quot;</span>&lt;&lt;f&lt;&lt;std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> f;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keyword">using namespace </span>multi_math;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(argc &lt;2)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; parameterfile&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;(supported formats for images: &quot;</span> &lt;&lt; <a name="a0"></a><a class="code" href="group__VigraImpex.html#ga1f42a533f86021968b8ca4d9d9644279">impexListFormats</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {   </div>
<div class="line">        <span class="keywordtype">char</span> infile[80],outfile[80];</div>
<div class="line">        <span class="keywordtype">double</span> alpha0=0.01*<a name="a1"></a><a class="code" href="group__FixedPointOperations.html#ga22d75753836176f3d172f58be11ecc4c">sqrt</a>(255.0),beta0=0.1*<a class="code" href="group__FixedPointOperations.html#ga22d75753836176f3d172f58be11ecc4c">sqrt</a>(255.0),sigma=0.1,rho=.5,K=10,eps=0,gamma0=0;</div>
<div class="line">        <span class="keywordtype">int</span> mode,inner_steps=200,outer_steps=5,write_steps=0;</div>
<div class="line">        </div>
<div class="line">        FILE *file=fopen(argv[1],<span class="stringliteral">&quot;r&quot;</span>);         <span class="comment">// open parameter file </span></div>
<div class="line">        <span class="keywordflow">if</span> (!file){</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;Cannot open file &quot;</span>&lt;&lt;argv[1]&lt;&lt;std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line">        read_string(file,<span class="stringliteral">&quot;input_file&quot;</span>,infile);    <span class="comment">// read name of input file (an image)</span></div>
<div class="line">        read_string(file,<span class="stringliteral">&quot;output_file&quot;</span>,outfile);  <span class="comment">// read name of output file (an image)</span></div>
<div class="line">        mode=(int)read_value(file,<span class="stringliteral">&quot;mode&quot;</span>);        <span class="comment">// read mode:  1- standard Total Variation</span></div>
<div class="line">        <span class="comment">//             2- Anisotropic Total Variation</span></div>
<div class="line">        <span class="comment">//             3- Anisotropic Total Variation with Higher Order term</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// further parameters depend on mode                          </span></div>
<div class="line">        <span class="keywordflow">switch</span>(mode){</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            inner_steps=1000;                 <span class="comment">// read number of iteration steps</span></div>
<div class="line">            alpha0=read_value(file,<span class="stringliteral">&quot;alpha&quot;</span>);  <span class="comment">// read alpha</span></div>
<div class="line">            eps=read_value(file,<span class="stringliteral">&quot;epsilon&quot;</span>);   <span class="comment">// read eps</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 3:</div>
<div class="line">            outer_steps=(int)read_value(file,<span class="stringliteral">&quot;outer_steps&quot;</span>); <span class="comment">// read number of outer iteration steps</span></div>
<div class="line">            inner_steps=(int)read_value(file,<span class="stringliteral">&quot;inner_steps&quot;</span>); <span class="comment">// read number of inner iteration steps</span></div>
<div class="line">            alpha0=read_value(file,<span class="stringliteral">&quot;alpha&quot;</span>);  <span class="comment">// read alpha</span></div>
<div class="line">            beta0=read_value(file,<span class="stringliteral">&quot;beta&quot;</span>);    <span class="comment">// read beta </span></div>
<div class="line">            sigma=read_value(file,<span class="stringliteral">&quot;sigma&quot;</span>);   <span class="comment">// read sigma</span></div>
<div class="line">            rho=read_value(file,<span class="stringliteral">&quot;rho&quot;</span>);       <span class="comment">// read rho</span></div>
<div class="line">            K=read_value(file,<span class="stringliteral">&quot;edge_factor&quot;</span>); <span class="comment">// read parameter K (edge sensitivity)</span></div>
<div class="line">            write_steps=(int)read_value(file,<span class="stringliteral">&quot;write_outer_steps&quot;</span>); <span class="comment">//read flag for writing intermediate result after each outer iteration</span></div>
<div class="line">            <span class="keywordflow">break</span>;  </div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> 4:</div>
<div class="line">            outer_steps=(int)read_value(file,<span class="stringliteral">&quot;outer_steps&quot;</span>); <span class="comment">// read number of outer iteration steps</span></div>
<div class="line">            inner_steps=(int)read_value(file,<span class="stringliteral">&quot;inner_steps&quot;</span>); <span class="comment">// read number of inner iteration steps</span></div>
<div class="line">            alpha0=read_value(file,<span class="stringliteral">&quot;alpha&quot;</span>); <span class="comment">// read alpha</span></div>
<div class="line">            beta0=read_value(file,<span class="stringliteral">&quot;beta&quot;</span>);   <span class="comment">// read beta </span></div>
<div class="line">            gamma0=read_value(file,<span class="stringliteral">&quot;gamma&quot;</span>); <span class="comment">// read gamma</span></div>
<div class="line">            sigma=read_value(file,<span class="stringliteral">&quot;sigma&quot;</span>);  <span class="comment">// read sigma</span></div>
<div class="line">            rho=read_value(file,<span class="stringliteral">&quot;rho&quot;</span>);      <span class="comment">// read rho</span></div>
<div class="line">            K=read_value(file,<span class="stringliteral">&quot;edge_factor&quot;</span>);<span class="comment">// read parameter K (edge sensitivity)</span></div>
<div class="line">            write_steps=(int)read_value(file,<span class="stringliteral">&quot;write_outer_steps&quot;</span>);<span class="comment">//read flag for writing intermediate result after each outer iteration</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;Unknown mode &quot;</span>&lt;&lt;mode&lt;&lt;std::endl;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">int</span> stretch=(int)read_value(file,<span class="stringliteral">&quot;histogram_stretch&quot;</span>);        <span class="comment">// flag for histogram stretching: 0 -no, 1 -yes</span></div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        <a name="_a2"></a><a class="code" href="classvigra_1_1ImageImportInfo.html">ImageImportInfo</a> info(infile); <span class="comment">// get information about input image</span></div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>(info.isGrayscale())</div>
<div class="line">        {</div>
<div class="line">            <a name="_a3"></a><a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> data(info.shape());</div>
<div class="line">            <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> out(info.shape()); </div>
<div class="line">            <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> weight(info.shape());  </div>
<div class="line">            </div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0;y&lt;data.shape(1);y++){</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0;x&lt;data.shape(0);x++){</div>
<div class="line">                    weight(x,y)=1;                         <span class="comment">// set weight to 1 (needed for anisotropicTotalVariationFilter and</span></div>
<div class="line">                    <span class="comment">// higherOrderTotalVariationFilter</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <a name="a4"></a><a class="code" href="group__VigraImpex.html#ga01aca6d5278dab14e11aef62e746e63e">importImage</a>(info, destImage(data));        <span class="comment">// read image data</span></div>
<div class="line">            data=data*(1/255.);                        <span class="comment">// scale to [0,1] (smoothing parameters are tuned to this scaling)</span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">//------------------------------------</span></div>
<div class="line">            <span class="comment">//     Choose specific TV Filter</span></div>
<div class="line">            <span class="comment">//------------------------------------</span></div>
<div class="line">            <span class="keywordflow">switch</span>(mode){</div>
<div class="line">            <span class="keywordflow">case</span> 1:</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Standard TV filter&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">                <a name="a5"></a><a class="code" href="group__NonLinearDiffusion.html#ga60041a186e8c6a6a7fb98a432bbee319">totalVariationFilter</a>(data,out,alpha0,inner_steps,eps);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 2: </div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Weighted TV filter&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">                <a class="code" href="group__NonLinearDiffusion.html#ga60041a186e8c6a6a7fb98a432bbee319">totalVariationFilter</a>(data,out,weight,alpha0,inner_steps,eps);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 3:{</div>
<div class="line">                    std::cout&lt;&lt;<span class="stringliteral">&quot;Anisotropic TV filter&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">                    </div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> phi(info.shape());</div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> alpha(info.shape());</div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> beta(info.shape()); </div>
<div class="line">                    </div>
<div class="line">                    out=data;   <span class="comment">//&#39;data&#39; serves as initial value</span></div>
<div class="line">                    </div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;outer_steps;i++){   <span class="comment">// Outer loop to update anisotropic data </span></div>
<div class="line">                        std::cout&lt;&lt;<span class="stringliteral">&quot;outer step &quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">                        </div>
<div class="line">                        <a name="a6"></a><a class="code" href="group__NonLinearDiffusion.html#ga826a11a3e56ff35a8f3dc38f2c7c9a5e">getAnisotropy</a>(out,phi,alpha,beta,alpha0,beta0,sigma,rho,K);  <span class="comment">// get anisotropic data</span></div>
<div class="line">                        <a name="a7"></a><a class="code" href="group__NonLinearDiffusion.html#gab03d88e6a6ccf3dd060534d58b8db5b8">anisotropicTotalVariationFilter</a>(data,weight,phi,alpha,beta,out,inner_steps); <span class="comment">//perform smoothing </span></div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span>(write_steps){</div>
<div class="line">                            <span class="keywordtype">char</span> dummy[80];</div>
<div class="line">                            sprintf(dummy,<span class="stringliteral">&quot;output_step_%03d.png&quot;</span>,i);</div>
<div class="line">                            std::cout&lt;&lt;<span class="stringliteral">&quot;Writing temp file\n&quot;</span>;</div>
<div class="line">                            <span class="keywordflow">if</span> (stretch)</div>
<div class="line">                            <a name="a8"></a><a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(out, <a name="_a9"></a><a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(dummy)); <span class="comment">//exportImage performes histogramm stretching</span></div>
<div class="line">                            <span class="keywordflow">else</span>{</div>
<div class="line">                                <a name="_a10"></a><a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,unsigned char&gt;</a>  buffer(info.shape());</div>
<div class="line">                                buffer=max(min(out*255+0.5,0.),255.);                              <span class="comment">//scaling back to [0,255], clipping, cast to uint8</span></div>
<div class="line">                                <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(buffer, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(dummy));</div>
<div class="line">                            }  </div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">            <span class="keywordflow">case</span> 4:{</div>
<div class="line">                    std::cout&lt;&lt;<span class="stringliteral">&quot;Second order TV filter&quot;</span>&lt;&lt;std::endl;</div>
<div class="line">                    </div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> phi(info.shape());</div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> alpha(info.shape());</div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> beta(info.shape());  </div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> <a name="a11"></a><a class="code" href="group__MathFunctions.html#ga441c9e4bf9f952c0fe94836634bcf976">gamma</a>(info.shape()); </div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> xedges(info.shape()); </div>
<div class="line">                    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,double&gt;</a> yedges(info.shape()); </div>
<div class="line">                    </div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0;y&lt;data.shape(1);y++){  <span class="comment">// set data needed for second order term</span></div>
<div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0;x&lt;data.shape(0);x++){</div>
<div class="line">                            <a class="code" href="group__MathFunctions.html#ga441c9e4bf9f952c0fe94836634bcf976">gamma</a>(x,y)=gamma0;</div>
<div class="line">                            xedges(x,y)=1;</div>
<div class="line">                            yedges(x,y)=1;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    </div>
<div class="line">                    out=data;  <span class="comment">//&#39;data&#39; serves as initial value</span></div>
<div class="line">                    </div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;outer_steps;i++){<span class="comment">// Outer loop to update anisotropic data </span></div>
<div class="line">                        std::cout&lt;&lt;<span class="stringliteral">&quot;outer step &quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">                        </div>
<div class="line">                        <a class="code" href="group__NonLinearDiffusion.html#ga826a11a3e56ff35a8f3dc38f2c7c9a5e">getAnisotropy</a>(out,phi,alpha,beta,alpha0,beta0,sigma,rho,K); <span class="comment">// get anisotropic data</span></div>
<div class="line">                        <a name="a12"></a><a class="code" href="group__NonLinearDiffusion.html#ga80e6e77f9e1a94080a3791981bb4fc0c">secondOrderTotalVariationFilter</a>(data,weight,phi,alpha,beta,<a class="code" href="group__MathFunctions.html#ga441c9e4bf9f952c0fe94836634bcf976">gamma</a>,xedges,yedges,out,inner_steps);<span class="comment">//perform smoothing </span></div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span>(write_steps){</div>
<div class="line">                            <span class="keywordtype">char</span> dummy[80];</div>
<div class="line">                            sprintf(dummy,<span class="stringliteral">&quot;output_step_%03d.png&quot;</span>,i);</div>
<div class="line">                            std::cout&lt;&lt;<span class="stringliteral">&quot;Writing temp file\n&quot;</span>; </div>
<div class="line">                            <span class="keywordflow">if</span> (stretch)</div>
<div class="line">                            <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(out, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(dummy));</div>
<div class="line">                            <span class="keywordflow">else</span>{</div>
<div class="line">                                <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,unsigned char&gt;</a>  buffer(info.shape());</div>
<div class="line">                                buffer=max(min(out*255+0.5,0.),255.);                              <span class="comment">//scaling back to [0,255], clipping, cast to uint8</span></div>
<div class="line">                                <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(buffer, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(dummy));</div>
<div class="line">                            }  </div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">//-------------------------------------</span></div>
<div class="line">            <span class="keywordflow">if</span> (stretch)</div>
<div class="line">            <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(out, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(outfile));  <span class="comment">//write result to file</span></div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2,unsigned char&gt;</a>  buffer(info.shape());</div>
<div class="line">                buffer=min(max(out*255.+0.5,0.),255.);                              <span class="comment">//scaling back to [0,255], clipping, cast to uint8</span></div>
<div class="line">                <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(buffer, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(outfile));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;Color images are currently not supported !\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (std::exception &amp; e)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- footer.html -->
<p>
<table border=0 cellspacing=0 width="100%"  bgcolor="#e0d0a0" cellpadding=5>
<tr>
<td>
<p>
<i>&copy; <A HREF="http://hci.iwr.uni-heidelberg.de/people/ukoethe/">Ullrich K&ouml;the</A>     (<A
HREF="mailto:ullrich.koethe@iwr.uni-heidelberg.de">ullrich.koethe@iwr.uni-heidelberg.de</A>)</i> <br>
<i><A HREF="http://hci.iwr.uni-heidelberg.de/">
Heidelberg Collaboratory for Image Processing</a>,
University of Heidelberg, Germany</i>
<td>
<p align=right>
<I>html generated using <A HREF="http://www.doxygen.org">doxygen</A> and <A HREF="http://www.python.org">Python</A></I>
<br>
<i>
vigra 1.11.0 (Thu Mar 17 2016)
</i>
</tr>
</table>
</BODY>
</HTML>
