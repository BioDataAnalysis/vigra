<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><TITLE>vigra - Image Input and Output</TITLE>
<link rel=stylesheet type="text/css" href="vigra.css">
<link rel=stylesheet type="text/css" href="vigra_1_8_2.css">
<link rel="shortcut icon" href="vigra-icon.ico" />
<script type="text/javascript">
function toggleHiddenDocumentation( textID, toggleID, toggleMessage )
{
	if( document.getElementById(textID).style.display == 'none' )
    {
		document.getElementById(textID).style.display = 'block';
        document.getElementById(toggleID).innerHTML = "hide " + toggleMessage;
    }
    else
    {
		document.getElementById(textID).style.display = 'none';
        document.getElementById(toggleID).innerHTML = "show " + toggleMessage;
	}
    return false;
}
</script>
<script>
var runOnLoad=function(c,o,d,e){function x(){for(e=1;c.length;)c.shift()()}o[d]?(document[d]('DOMContentLoaded',x,0),o[d]('load',x,0)):o.attachEvent('onload',x);return function(t){e?o.setTimeout(t,0):c.push(t)}}([],window,'addEventListener');
</script>
<script type="text/javascript" src="documents/CollapsibleLists.js"></script>
<script type="text/javascript">
    runOnLoad(function(){ CollapsibleLists.apply(); });
</script>
<style type="text/css">
.collapsibleList li.collapsibleListOpen{
  list-style-image:url('documents/pfeil.gif');
  cursor:pointer;
}
.collapsibleList li.collapsibleListClosed{
  list-style-image:url('documents/bullet.gif');
  cursor:pointer;
}
.collapsibleList li.lastItem{
  list-style-image:url('documents/diamond.gif');
}
</style>
</head>
<body  bgcolor="#f8f0e0" link="#0040b0" vlink="#a00040">
<basefont face="Helvetica,Arial,sans-serif" size=3>
<p align=right>
[ <a href="http://ukoethe.github.io/vigra/">VIGRA Homepage</a> |
 <a href="functionindex.html">Function Index</a> |
 <a href="classes.html">Class Index</a> |
 <a href="namespaces.html">Namespaces</a> |
 <a href="files.html">File List</a> |
 <a href="index.html">Main Page</a> ]
</p>
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="contents">
<table class="main_heading">
<tr>
<td width="100%">Image Input and Output 
</td>
<td align=right><a href="http://hci.iwr.uni-heidelberg.de/vigra/"><IMG border=0 ALT="VIGRA" SRC="documents/vigra.gif" title="VIGRA Homepage"></a></td></tr>
</table><p>

<div class="textblock"><h2>Section Contents</h2>
<ul style="list-style-image:url(documents/diamond.gif)">
<li>
<a class="el" href="ImageInputOutputTutorial.html#Impex2D">Two-Dimensional Images</a> </li>
<li>
<a class="el" href="ImageInputOutputTutorial.html#ImpexND">Higher Dimensional Arrays</a> </li>
</ul>
<h1><a class="anchor" id="Impex2D"></a>
Two-Dimensional Images</h1>
<p>In this section we'll show you how to import and export an image with VIGRA. If you want to import an image from disk and enquire about its properties, you must use an object of <code><a class="el" href="classvigra_1_1ImageImportInfo.html" title="Argument object for the function importImage(). ">vigra::ImageImportInfo</a></code> class. It reads the header of the image file. The constructor expects the file name, the file type will be determined automatically.</p>
<p>The <code><a class="el" href="classvigra_1_1ImageImportInfo.html" title="Argument object for the function importImage(). ">vigra::ImageImportInfo</a></code> class currently recognizes the following file formats:</p>
<dl>
<dt><b>BMP:</b> </dt>
<dd>Microsoft Windows bitmap image file. </dd>
<dt><b>EXR:</b> </dt>
<dd>OpenEXR high dynamic range image format. (only available if libopenexr is installed) </dd>
<dt><b>GIF:</b> </dt>
<dd>CompuServe graphics interchange format; 8-bit color. </dd>
<dt><b>HDR:</b> </dt>
<dd>Radiance RGBE high dynamic range image format. </dd>
<dt><b>JPEG:</b> </dt>
<dd>Joint Photographic Experts Group JFIF format - compressed 24-bit color (only available if libjpeg is installed). </dd>
<dt><b>PNG:</b> </dt>
<dd>Portable Network Graphic (only available if libpng is installed). </dd>
<dt><b>PBM:</b> </dt>
<dd>Portable bitmap format (black and white). </dd>
<dt><b>PGM:</b> </dt>
<dd>Portable graymap format (gray scale). </dd>
<dt><b>PNM:</b> </dt>
<dd>Portable anymap. </dd>
<dt><b>PPM:</b> </dt>
<dd>Portable pixmap format (color). </dd>
<dt><b>SUN:</b> </dt>
<dd>SUN Rasterfile. </dd>
<dt><b>TIFF:</b> </dt>
<dd>Tagged Image File Format. (only available if libtiff is installed.) </dd>
<dt><b>VIFF:</b> </dt>
<dd>Khoros Visualization image file. </dd>
</dl>
<p>In the following example, the image file name is given in the first command line argument, and the most important image metadata are printed:</p>
 <div class="fragment"><div class="line">        <span class="comment">// read image given as first command-line argument</span></div>
<div class="line">        <a class="code" href="classvigra_1_1ImageImportInfo.html">vigra::ImageImportInfo</a> imageInfo(argv[1]);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// print some information:</span></div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Image information:\n&quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  file format: &quot;</span> &lt;&lt; imageInfo.getFileType() &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  width:       &quot;</span> &lt;&lt; imageInfo.width() &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  height:      &quot;</span> &lt;&lt; imageInfo.height() &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  pixel type:  &quot;</span> &lt;&lt; imageInfo.getPixelType() &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  color image: &quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (imageInfo.isColor())    std::cout &lt;&lt; <span class="stringliteral">&quot;yes (&quot;</span>;</div>
<div class="line">        <span class="keywordflow">else</span>                        std::cout &lt;&lt; <span class="stringliteral">&quot;no  (&quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;number of channels: &quot;</span> &lt;&lt; imageInfo.numBands() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
</div><!-- fragment --></p>
<p>As you can see, the <code> ImageImportInfo </code> object contains a lot of information, some of it is printed in the example. Using this image</p>
<div class="image">
<img src="lenna_small.gif" alt="lenna_small.gif"/>
<div class="caption">
input file</div></div>
<p> we get the following output:</p>
<pre class="fragment">Image information:
  file format: GIF
  width:       154
  height:      145
  pixel type:  UINT8
  color image: no  (number of channels: 1)
</pre><p>To process the image, we must load the actual image data into an array such as the one described in <a class="el" href="MultiDimensionalArrayTutorial.html#MultiArrayBasics">Basic MultiArray Usage</a>. To do so, we create a <code><a class="el" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management. ">vigra::MultiArray</a></code> with the appropriate shape and then call <a class="el" href="group__VigraImpex.html#ga01aca6d5278dab14e11aef62e746e63e">vigra::importImage()</a>. This function needs an <code> ImageImportInfo </code> object specifying the image to be loaded and a MultiArrayView object of apropriate size to copy the image data in. The code looks like this:</p>
 <div class="fragment"><div class="line">        <span class="comment">// read image header information from in_filename</span></div>
<div class="line">        ImageImportInfo imageInfo(in_filename);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// instantiate array for image data</span></div>
<div class="line">        MultiArray&lt;2, UInt8&gt; imageArray(imageInfo.shape());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// copy image data from file into array</span></div>
<div class="line">        importImage(imageInfo, imageArray);</div>
</div><!-- fragment --></p>
<p>If you already know the type of data in the file, you can also just pass the filename and a MultiArray, which will automatically be resized as appropariate:</p>
 <div class="fragment"><div class="line">        <span class="comment">// if you don&#39;t need the information from ImageImportInfo, you can also</span></div>
<div class="line">        <span class="comment">// simply pass the filename (this will resize imageArray internally!)</span></div>
<div class="line">        importImage(in_filename, imageArray);</div>
</div><!-- fragment --></p>
<p>Writing the image data from an array to a file is quite similar. For this purpose, you use the function <a class="el" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">vigra::exportImage()</a>, which takes an 2D MultiArrayView and an <a class="el" href="classvigra_1_1ImageExportInfo.html">vigra::ImageExportInfo</a> object or a string (the filename). The ImageExportInfo object also needs a file name, but gives you more control over how the image is written. The desired file format is guessed from the file name's extension (but can be overridden with the method <code>ImageExportInfo::setFileType</code>. Recognized extensions are: '.bmp', '.exr', '.gif', '.jpeg', '.jpg', '.p7', '.png', '.pbm', '.pgm', '.pnm', '.ppm', '.ras', '.tif', '.tiff', '.xv', '.hdr' (as for reading, '.exr' requires libopenexr, '.jpg' requires libjpeg, '.png' requires libpng and '.tif' requires libtiff). In the following example, we create and save a 160x160 pixels image, where the image is a checkerboard. The image is saved as "testimage.gif" in the same folder as the executed code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/multi_array.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/stdimage.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="impex_8hxx.html">vigra/impex.hxx</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>vigra; </div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) </div>
<div class="line">{</div>
<div class="line">    <span class="comment">// instantiate array for image data of size 160x160 pixels</span></div>
<div class="line">    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2, UInt8&gt;</a> imageArray(Shape2(160,160));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a black (0) and white (255) checker-board image</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; imageArray.shape(1); y++) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// note that the inner loop should go over the first (x-) axis</span></div>
<div class="line">        <span class="comment">// because elements along the first axis are consecutive in memory</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; imageArray.shape(0); x++) </div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ((x%20)/10 == (y%20)/10)</div>
<div class="line">                imageArray(x,y) = 0;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                imageArray(x,y) = 255; </div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// write image data to &quot;testimage.jpg&quot; and set compression to 70%</span></div>
<div class="line">    <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(imageArray, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(<span class="stringliteral">&quot;testimage.jpg&quot;</span>).setCompression(<span class="stringliteral">&quot;JPEG QUALITY=70&quot;</span>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// if you don&#39;t want to set any options in ImageExportInfo, you can simply write</span></div>
<div class="line">    <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(imageArray, <span class="stringliteral">&quot;testimage.gif&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The resulting images are the following:</p>
<table  cellspacing="10">
<tr valign="bottom">
<td><div class="image">
<img src="testimage.jpg" alt="testimage.jpg"/>
<div class="caption">
testimage.jpg</div></div>
  </td><td><div class="image">
<img src="testimage.gif" alt="testimage.gif"/>
<div class="caption">
testimage.gif</div></div>
   </td></tr>
</table>
<p>Finally, we give a complete example of importing, editing and exporting an image. After importing, we set every other horizontal line to black. This can be done with the <code>bind&lt;M&gt;(i)</code> method explained in <a class="el" href="MultiDimensionalArrayTutorial.html#MultiArray_bind">bind&lt;M&gt;(i) and bindAt(M, i)</a>. Input and output file names are specified via command line arguments.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/multi_array.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vigra/stdimage.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="impex_8hxx.html">vigra/impex.hxx</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>vigra;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) </div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(argc != 3)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; infile outfile&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;(grayscale only, supported formats: &quot;</span> &lt;&lt; <a class="code" href="group__VigraImpex.html#ga1f42a533f86021968b8ca4d9d9644279">impexListFormats</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">try</span> </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">char</span> * in_filename  = argv[1];</div>
<div class="line">        <span class="keywordtype">char</span> * out_filename = argv[2];</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// read image header information from in_filename</span></div>
<div class="line">        <a class="code" href="classvigra_1_1ImageImportInfo.html">ImageImportInfo</a> imageInfo(in_filename);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// instantiate array for image data</span></div>
<div class="line">        <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2, UInt8&gt;</a> imageArray(imageInfo.shape());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// copy image data from file into array</span></div>
<div class="line">        <a class="code" href="group__VigraImpex.html#ga01aca6d5278dab14e11aef62e746e63e">importImage</a>(imageInfo, imageArray);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// if you don&#39;t need the information from ImageImportInfo, you can also</span></div>
<div class="line">        <span class="comment">// simply pass the filename (this will resize imageArray internally!)</span></div>
<div class="line">        <a class="code" href="group__VigraImpex.html#ga01aca6d5278dab14e11aef62e746e63e">importImage</a>(in_filename, imageArray);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// set every second horizontal line to black</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;imageInfo.height(); i+=2) </div>
<div class="line">        {</div>
<div class="line">            imageArray.bind&lt;1&gt;(i) = 0;   </div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// write image data to the file given as second argument</span></div>
<div class="line">        <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3">exportImage</a>(imageArray, <a class="code" href="classvigra_1_1ImageExportInfo.html">ImageExportInfo</a>(out_filename));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (std::exception &amp; e) </div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// catch any errors that might have occurred and print their reason</span></div>
<div class="line">        std::cout &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The input image and the resulting output image are:</p>
<table  cellspacing="10">
<tr valign="bottom">
<td><div class="image">
<img src="lenna_small.gif" alt="lenna_small.gif"/>
<div class="caption">
input image</div></div>
  </td><td><div class="image">
<img src="lenna_stripes.gif" alt="lenna_stripes.gif"/>
<div class="caption">
output image</div></div>
   </td></tr>
</table>
<p>The handling of <b>color images</b> is exactly the same, but instead of instantiating a <code>vigra::MultiArray&lt;2, UInt8&gt;</code> you need a <code> <a class="el" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management. ">vigra::MultiArray</a>&lt;2, vigra::RGBValue&lt;UInt8&gt; &gt; </code> array as described in <a class="el" href="MultiDimensionalArrayTutorial.html#MultiArrayBasics">Basic MultiArray Usage</a>. Images with alpha channel are supported by <a class="el" href="group__VigraImpex.html#ga1a3e91752dac6d0a9be46fe10f337530">importImageAlpha()</a> and <a class="el" href="group__VigraImpex.html#ga49740e4e75cbfa7ffc12b4a149281a06">exportImageAlpha()</a>.</p>
<p>Note that image processing often requires more complicated calculations than in these examples. In this case, it is better to import and convert the data into a <code>float</code> array (i.e. <code>vigra::MultiArray&lt;2, float&gt;</code>) instead of the simple <code>unsigned char</code> type in order to minimize rounding errors. When a file is imported into such an array, the conversion is automatically performed by the importImage() function. When an array is to be exported, the handling of <code>float</code> depends on the file format: If the file format supports float (currently: TIFF and VIFF), the data are written verbatim (unless this is explicitly overridden, see below). Otherwise, the data are mapped to <code>unsigned char</code> via a linear transform of the orginal range, followed by rounding (use <a class="el" href="group__TransformFunctor.html#ga500478e445d819abfc4dc9a748dcba5d">vigra::linearRangeMapping()</a> to override this behavior by an explicit user-defined mapping).</p>
<p>The <code>ImageExportInfo</code> class provides a number of additional methods to <b>customize data export</b>, including:</p>
<dl>
<dt><b>setCompression():</b> </dt>
<dd>Request compressed storage if the file format supports it. </dd>
<dt><b>setFileType():</b> </dt>
<dd>Provide the file format explicitly instead of guessing from the filename extension. </dd>
<dt><b>setPixelType():</b> </dt>
<dd>Request pixels to be stored as the given type (results in an exception if the type is unsupported by the file format). </dd>
<dt><b> setXResolution(), setYResolution:</b> </dt>
<dd>Store resolution information for the two axes (ignored if unsupported by the file format). </dd>
</dl>
<p>See <a class="el" href="classvigra_1_1ImageExportInfo.html">vigra::ImageExportInfo</a> for a complete list and more details.</p>
<h1><a class="anchor" id="ImpexND"></a>
Higher Dimensional Arrays</h1>
<p>The recommended file format for arrays of arbitrary dimension is <a href="http://www.hdfgroup.org/HDF5/">HDF5</a>. It supports all possible pixel types, arbitrary dimensions, on-the-fly compression, arbitrary many arrays per file, and flexible metadata storage along with arrays. See <a class="el" href="group__VigraHDF5Impex.html">Import/Export of Images and Arrays in HDF5 Format</a> for more information.</p>
<p>The functions <a class="el" href="group__VolumeImpex.html#gaa8328600a03da4d2849fe33f2a080705">importVolume()</a> and <a class="el" href="group__VolumeImpex.html#gac9a23a3dac8373296367f882493d2d60">exportVolume()</a> support three additional methods to read and write 3D volume data: </p>
<ul>
<li>
Multipage TIFF (read/write) and Andor SIF (read only) file formats. </li>
<li>
Image stacks (consisting of one 2D image per slice - read/write). </li>
<li>
Raw data if accompanied with an additional text file providing the necessary metadata (shape, pixel type etc.) - read only. </li>
</ul>
</div></div><!-- contents -->
<!-- footer.html -->
<p>
<table border=0 cellspacing=0 width="100%"  bgcolor="#e0d0a0" cellpadding=5>
<tr>
<td>
<p>
<i>&copy; <A HREF="http://hci.iwr.uni-heidelberg.de/people/ukoethe/">Ullrich K&ouml;the</A>     (<A
HREF="mailto:ullrich.koethe@iwr.uni-heidelberg.de">ullrich.koethe@iwr.uni-heidelberg.de</A>)</i> <br>
<i><A HREF="http://hci.iwr.uni-heidelberg.de/">
Heidelberg Collaboratory for Image Processing</a>,
University of Heidelberg, Germany</i>
<td>
<p align=right>
<I>html generated using <A HREF="http://www.doxygen.org">doxygen</A> and <A HREF="http://www.python.org">Python</A></I>
<br>
<i>
vigra 1.11.0 (Fri May 19 2017)
</i>
</tr>
</table>
</BODY>
</HTML>
